{% extends "base.html" %}

{% block title %}Browse Profiles{% endblock %}

{% block content %}
  <div class="browse-profiles-container">
    <h2>Browse Profiles</h2>

    <!-- Countdown Timer -->
    <div class="countdown">
        Time until next match: 
        <span id="hours">00</span>:<span id="minutes">00</span>:<span id="seconds">00</span>
    </div>

    {% for profile in profiles %}
    <div class="profile-card">
      <h3><a href="{% url 'view_single_profile' profile.user.id %}">{{ profile.user.username }}</a></h3>
      <p><strong>Gender:</strong> {{ profile.get_gender_display }}</p>
      <p><strong>Pronoun Preference:</strong> {{ profile.get_pronoun_preference_display }}</p>
      
      <!-- Display Profile Picture -->
      <div class="profile-picture">
        {% if profile.profile_picture %}
          <img src="{{ profile.profile_picture.url }}" alt="{{ profile.user.username }}'s Profile Picture" class="profile-img" style="max-width: 200px; max-height: 200px;">
        {% else %}
          No profile picture available
        {% endif %}
      </div>

      <!-- Display Open to Dating preferences -->
      <p>
          <strong>Open to Dating:</strong>
          {% if profile.open_to_dating.all %}
              {% for preference in profile.open_to_dating.all %}
                  {{ preference.gender }}{% if not forloop.last %}, {% endif %}
              {% endfor %}
          {% else %}
              Not specified
          {% endif %}
      </p>

      <a href="{% url 'view_single_profile' profile.user.id %}" class="btn btn-primary">View Profile</a>
    </div>
    {% empty %}
    <p>No profiles available.</p>
    {% endfor %}
    
    <div class="pagination">
      <span class="step-links">
          {% if profiles.has_previous %}
              <a href="?page=1">&laquo; first</a>
              <a href="?page={{ profiles.previous_page_number }}">previous</a>
          {% endif %}

          <span class="current">
              Page {{ profiles.number }} of {{ profiles.paginator.num_pages }}.
          </span>

          {% if profiles.has_next %}
              <a href="?page={{ profiles.next_page_number }}">next</a>
              <a href="?page={{ profiles.paginator.num_pages }}">last &raquo;</a>
          {% endif %}
      </span>
    </div>
  </div>

  <!-- Countdown Functionality Script -->
  <script>
      function getTimeUntilMidnight() {
          const now = new Date();
          const midnight = new Date(now);
          midnight.setHours(24, 0, 0, 0); // Set the time to next midnight
          const timeDiff = midnight - now;
          return {
              hours: Math.floor(timeDiff / (1000 * 60 * 60)),
              minutes: Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60)),
              seconds: Math.floor((timeDiff % (1000 * 60)) / 1000)
          };
      }

      function updateCountdownDisplay() {
          const { hours, minutes, seconds } = getTimeUntilMidnight();
          document.getElementById('hours').innerText = String(hours).padStart(2, '0');
          document.getElementById('minutes').innerText = String(minutes).padStart(2, '0');
          document.getElementById('seconds').innerText = String(seconds).padStart(2, '0');
      }

      // Immediately update the countdown display when the page loads
      updateCountdownDisplay();
      // Then update the countdown display every second
      setInterval(updateCountdownDisplay, 1000);
  </script>
{% endblock %}

